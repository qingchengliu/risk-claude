# Dev Code Workflow for Java8 + Spring + TestNG Projects

è¿™æ˜¯ä¸€ä¸ªé’ˆå¯¹ Java8 + Spring + TestNG é¡¹ç›®çš„å¼€å‘å·¥ä½œæµå‘½ä»¤ã€‚

---

## Step 0: æ–¹æ¡ˆè¾“å…¥éªŒè¯

**å¿…é¡»è¦æ±‚ç”¨æˆ·æä¾›æ–¹æ¡ˆè¾“å…¥**

æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æä¾›äº†æ–¹æ¡ˆè¾“å…¥ï¼š
- å¦‚æœç”¨æˆ·è¾“å…¥äº† `@.claude/specs/{feature_name}/dev-plan.md` æ–‡ä»¶è·¯å¾„ï¼Œåˆ™ç›´æ¥ä½¿ç”¨è¯¥æ–¹æ¡ˆ
- å¦‚æœç”¨æˆ·è¾“å…¥äº†å…¶ä»–å½¢å¼çš„æ–¹æ¡ˆæè¿°ï¼ˆéœ€æ±‚æ–‡æ¡£ã€æŠ€æœ¯æ–¹æ¡ˆç­‰ï¼‰ï¼Œåˆ™éœ€è¦åœ¨ Step 1 è¿›è¡Œä»»åŠ¡æ‹†è§£
- å¦‚æœç”¨æˆ·**æ²¡æœ‰æä¾›ä»»ä½•æ–¹æ¡ˆè¾“å…¥**ï¼Œåˆ™ä½¿ç”¨ `AskUserQuestion` å·¥å…·è¯¢é—®ç”¨æˆ·ï¼š
  ```
  è¯·æä¾›å¼€å‘æ–¹æ¡ˆè¾“å…¥ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š
  1. dev-plan.md æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ @.claude/specs/feature_name/dev-plan.mdï¼‰
  2. éœ€æ±‚æ–‡æ¡£æˆ–æŠ€æœ¯æ–¹æ¡ˆæè¿°
  3. åŠŸèƒ½æè¿°å’Œå®ç°è¦æ±‚
  ```

---

## Step 1: å¼€å‘è®¡åˆ’ç”Ÿæˆé˜¶æ®µ

**æ ¹æ®æ–¹æ¡ˆè¾“å…¥ç±»å‹å¤„ç†ï¼š**

1. **å¦‚æœç”¨æˆ·æä¾›çš„æ˜¯ `@.claude/specs/{feature_name}/dev-plan.md` æ–‡ä»¶è·¯å¾„**ï¼š
   - ç›´æ¥è¯»å–è¯¥æ–‡ä»¶ä½œä¸ºå¼€å‘è®¡åˆ’
   - è·³è¿‡ä»»åŠ¡æ‹†è§£ï¼Œè¿›å…¥ Step 2

2. **å¦‚æœç”¨æˆ·æä¾›çš„æ˜¯å…¶ä»–å½¢å¼çš„æ–¹æ¡ˆ**ï¼š
   - åˆ†æç”¨æˆ·æä¾›çš„æ–¹æ¡ˆå†…å®¹
   - ä½¿ç”¨ `spec-plan-generator` agent è¿›è¡ŒæŠ€æœ¯åˆ†æå’Œä»»åŠ¡æ‹†è§£ï¼š
     ```
     Task tool with subagent_type='spec-plan-generator'
     prompt: åŸºäºç”¨æˆ·æä¾›çš„æ–¹æ¡ˆï¼Œç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆå’Œå¼€å‘è®¡åˆ’æ–‡æ¡£
     ```
   - ç”Ÿæˆçš„æ–‡æ¡£å°†ä¿å­˜åˆ° `.claude/specs/{feature_name}/`ï¼š
     - `tech-spec.md` - æŠ€æœ¯æ–¹æ¡ˆ
     - `dev-plan.md` - å¼€å‘è®¡åˆ’
   - å±•ç¤ºç”Ÿæˆçš„å¼€å‘è®¡åˆ’ç»™ç”¨æˆ·ç¡®è®¤

---

## Step 2: å¹¶è¡Œå¼€å‘é˜¶æ®µ

### 2.1 ç”¨æˆ·é€‰æ‹©ç¡®è®¤

ä½¿ç”¨ `AskUserQuestion` å·¥å…·è¯¢é—®ç”¨æˆ·ä¸¤ä¸ªé—®é¢˜ï¼š

**é—®é¢˜ Aï¼šé€‰æ‹©ä»£ç ç¼–å†™æ–¹å¼**
- **Claude ä¸» Agent**ï¼šåœ¨å½“å‰ä¸Šä¸‹æ–‡çª—å£ä¸²è¡Œç¼–å†™ä»£ç ï¼ˆæ¨èï¼Œé€‚åˆéœ€è¦æ·±åº¦ä¸Šä¸‹æ–‡ç†è§£çš„ä»»åŠ¡ï¼‰
- **Codex å­ä»£ç†**ï¼šä½¿ç”¨ OpenAI Codex è¿›è¡Œä»£ç ç”Ÿæˆï¼ˆé€‚åˆå¤§é‡å¹¶è¡Œä»»åŠ¡ï¼‰
- **Claude å­ä»£ç†**ï¼šä½¿ç”¨ Claude å­ä»£ç†è¿›è¡Œä»£ç ç”Ÿæˆ

è®°ä½ç”¨æˆ·é€‰æ‹©ä¸º `${backend}`ï¼ˆmain / codex / claudeï¼‰

**é—®é¢˜ Bï¼šå•å…ƒæµ‹è¯•æ—¶æœº**
- **é©¬ä¸Šç¼–ç å•å…ƒæµ‹è¯•**ï¼šæ¯ä¸ªä»»åŠ¡å®Œæˆåç«‹å³ç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•
- **ç¨åç»Ÿä¸€å¤„ç†**ï¼šå…ˆå®Œæˆæ‰€æœ‰åŠŸèƒ½ä»£ç ï¼Œæœ€åç»Ÿä¸€ç¼–å†™å•å…ƒæµ‹è¯•

### 2.2 æ‰§è¡Œå¼€å‘ä»»åŠ¡

#### å¦‚æœç”¨æˆ·é€‰æ‹© Claude ä¸» Agentï¼š

åœ¨å½“å‰ä¸Šä¸‹æ–‡çª—å£å¯¹å¤šä¸ªä»»åŠ¡ä¸²è¡Œè¿›è¡Œä»£ç ç¼–å†™ï¼š
1. æŒ‰ç…§ dev-plan.md ä¸­çš„ä»»åŠ¡é¡ºåºé€ä¸ªå®Œæˆ
2. æ¯ä¸ªä»»åŠ¡å®Œæˆåæ›´æ–° TodoWrite
3. å¦‚æœç”¨æˆ·é€‰æ‹©é©¬ä¸Šç¼–ç å•å…ƒæµ‹è¯•ï¼Œåˆ™æ¯ä¸ªä»»åŠ¡åç«‹å³ç¼–å†™æµ‹è¯•

#### å¦‚æœç”¨æˆ·é€‰æ‹© Codex æˆ– Claude å­ä»£ç†ï¼š

ä½¿ç”¨ `codeagent` skill è°ƒç”¨ codeagent-wrapper å®Œæˆä»»åŠ¡ï¼š

```bash
# Backend task (use ${backend} backend)
codeagent-wrapper --backend ${backend} - <<'EOF'
Task: [task-id]
Reference: @.claude/specs/{feature_name}/dev-plan.md
Scope: [task file scope]
Deliverables: code + unit testsï¼ˆå¦‚æœç”¨æˆ·é€‰æ‹©é©¬ä¸Šç¼–ç ï¼‰
Context: [context detail if task may need]
EOF
```

**âš ï¸ å¹¶å‘æ‰§è¡Œè§„åˆ™ï¼ˆé‡è¦ï¼‰ï¼š**

1. **åˆ¤æ–­ä»»åŠ¡ä¾èµ–å…³ç³»**ï¼šåˆ†æ dev-plan.md ä¸­çš„ä»»åŠ¡ä¾èµ–
2. **æ— ä¾èµ–ä»»åŠ¡å¿…é¡»å¹¶è¡Œ**ï¼šå¯å¹¶è¡Œçš„ä»»åŠ¡**å¿…é¡»åœ¨åŒä¸€ä¸ªæ¶ˆæ¯ä¸­**å‘é€å¤šä¸ª Bash å·¥å…·è°ƒç”¨
3. **æœ€å¤§ä¸‰å¹¶å‘**ï¼šåŒæ—¶è¿è¡Œçš„ä»»åŠ¡ä¸è¶…è¿‡ 3 ä¸ª

**å¹¶è¡Œæ‰§è¡Œç¤ºä¾‹ï¼ˆæ­£ç¡®åšæ³•ï¼‰ï¼š**

å½“ Task 2 å’Œ Task 3 éƒ½ä¾èµ– Task 1ï¼Œä¸” Task 1 å·²å®Œæˆæ—¶ï¼š

```
# âœ… æ­£ç¡®ï¼šåœ¨åŒä¸€ä¸ªæ¶ˆæ¯ä¸­å‘é€ä¸¤ä¸ª Bash è°ƒç”¨ï¼ˆè‡ªåŠ¨å¹¶è¡Œï¼‰
<message>
  Bash(command="codeagent-wrapper --backend codex ...")  # Task 2
  Bash(command="codeagent-wrapper --backend codex ...")  # Task 3
</message>

# âŒ é”™è¯¯ï¼šåˆ†ä¸¤ä¸ªæ¶ˆæ¯å‘é€ï¼ˆä¼šå¯¼è‡´ä¸²è¡Œæ‰§è¡Œï¼‰
<message>
  Bash(command="codeagent-wrapper --backend codex ...")  # Task 2
</message>
<message>
  Bash(command="codeagent-wrapper --backend codex ...")  # Task 3
</message>
```

**ä»»åŠ¡è°ƒåº¦æµç¨‹ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. åˆ†æä»»åŠ¡ä¾èµ–å…³ç³»                                     â”‚
â”‚     Task 1: æ— ä¾èµ–                                      â”‚
â”‚     Task 2: ä¾èµ– Task 1                                 â”‚
â”‚     Task 3: ä¾èµ– Task 1                                 â”‚
â”‚     Task 4: ä¾èµ– Task 2, Task 3                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. æ‰§è¡Œ Task 1ï¼ˆå•ç‹¬æ‰§è¡Œï¼Œç­‰å¾…å®Œæˆï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. Task 1 å®Œæˆåï¼Œå¹¶è¡Œæ‰§è¡Œ Task 2 å’Œ Task 3             â”‚
â”‚     â†’ åœ¨åŒä¸€æ¶ˆæ¯ä¸­å‘é€ä¸¤ä¸ª Bash è°ƒç”¨                    â”‚
â”‚     â†’ ç³»ç»Ÿè‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Task 2, 3 éƒ½å®Œæˆåï¼Œæ‰§è¡Œ Task 4                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 3: ä»»åŠ¡æ€»ç»“

### 3.1 ä»£ç ç¼–è¯‘éªŒè¯

ä½¿ç”¨ Subagent è¿è¡Œä»£ç ç¼–è¯‘ï¼š

```bash
# å¯¹äº Maven é¡¹ç›®
mvn compile -q

# å¦‚æœç¼–è¯‘å¤±è´¥ï¼ŒSubagent è¿”å›è¯¦ç»†çš„æŠ¥é”™ä¿¡æ¯
```

**ç¼–è¯‘å¤±è´¥å¤„ç†ï¼š**
- Subagent æ”¶é›†å®Œæ•´çš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯
- åˆ†æé”™è¯¯åŸå› ï¼ˆè¯­æ³•é”™è¯¯ã€ä¾èµ–ç¼ºå¤±ã€ç±»å‹ä¸åŒ¹é…ç­‰ï¼‰
- æä¾›ä¿®å¤å»ºè®®
- å¦‚æœ‰éœ€è¦ï¼Œè‡ªåŠ¨ä¿®å¤ç®€å•çš„ç¼–è¯‘é”™è¯¯

### 3.2 ä»»åŠ¡å®Œæˆæ€»ç»“

æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

**ä»»åŠ¡å®Œæˆåˆ—è¡¨ï¼š**
```
âœ… å·²å®Œæˆä»»åŠ¡ï¼š
  - [Task-1] å®ç° UserService
  - [Task-2] å®ç° OrderService
  - [Task-3] ç¼–å†™ UserServiceTest

âŒ æœªå®Œæˆä»»åŠ¡ï¼ˆå¦‚æœ‰ï¼‰ï¼š
  - [Task-4] åŸå› ï¼šxxx
```

**å…³é”®æ–‡ä»¶ä¿®æ”¹ï¼š**
```
ğŸ“ ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨ï¼š
  - src/main/java/com/example/service/UserService.java (æ–°å¢)
  - src/main/java/com/example/repository/UserRepository.java (ä¿®æ”¹)
  - src/test/java/com/example/service/UserServiceTest.java (æ–°å¢)
```

---

## å¼‚å¸¸å¤„ç†

### Codeagent å¤±è´¥å¤„ç†
- **é‡è¯•ç­–ç•¥**ï¼šå¤±è´¥åè‡ªåŠ¨é‡è¯•ä¸€æ¬¡
- **é‡è¯•ä»å¤±è´¥**ï¼šè®°å½•é”™è¯¯æ—¥å¿—ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡
- **é”™è¯¯è®°å½•æ ¼å¼**ï¼š
  ```
  âš ï¸ Task [task-id] æ‰§è¡Œå¤±è´¥
  é”™è¯¯ä¿¡æ¯ï¼š[error message]
  å·²è·³è¿‡ï¼Œç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡
  ```

### ä¾èµ–å†²çªå¤„ç†
- æ£€æµ‹åˆ°ä»»åŠ¡é—´å­˜åœ¨ä¾èµ–å†²çªæ—¶ï¼Œ**è‡ªåŠ¨åºåˆ—åŒ–æ‰§è¡Œ**
- ç¤ºä¾‹ï¼šTask B ä¾èµ– Task A çš„è¾“å‡ºï¼Œåˆ™ç­‰å¾… Task A å®Œæˆåå†æ‰§è¡Œ Task B

---

## Communication Style

- **ç›´æ¥ç®€æ´**ï¼šæŠ¥å‘Šè¿›åº¦æ—¶ä½¿ç”¨ç®€çŸ­æ˜äº†çš„è¯­è¨€
- **è¿›åº¦æ±‡æŠ¥**ï¼šæ¯ä¸ªå·¥ä½œæµæ­¥éª¤å®Œæˆåæ±‡æŠ¥çŠ¶æ€
- **é—®é¢˜é«˜äº®**ï¼šé‡åˆ°é˜»å¡é—®é¢˜ç«‹å³é«˜äº®æ˜¾ç¤º
- **å¯æ‰§è¡Œå»ºè®®**ï¼šè¦†ç›–ç‡æ£€æŸ¥å¤±è´¥æ—¶æä¾›å…·ä½“çš„ä¿®å¤æ­¥éª¤
- **é€Ÿåº¦ä¼˜å…ˆ**ï¼šé€šè¿‡å¹¶è¡ŒåŒ–æå‡æ‰§è¡Œé€Ÿåº¦ï¼ŒåŒæ—¶ç¡®ä¿è¦†ç›–ç‡éªŒè¯

---

## å•å…ƒæµ‹è¯•è§„èŒƒ

### è¿è¡Œæµ‹è¯•

å¤šæ¨¡å— Maven é¡¹ç›®éœ€ä»æ ¹ç›®å½•è¿è¡Œæµ‹è¯•ï¼Œé¿å…ä¾èµ–æ¨¡å—æœªç¼–è¯‘çš„é—®é¢˜ï¼š

```bash
# 1. åˆ›å»ºä¸´æ—¶ testng xmlï¼ˆæŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•ç±»ï¼‰
# æ–‡ä»¶è·¯å¾„: {starter-module}/src/test/resources/testng_ut_checkin_temp.xml

# 2. ä»æ ¹ç›®å½•è¿è¡Œ
mvn test -DsuiteXmlFile=src/test/resources/testng_ut_checkin_temp.xml

# 3. æµ‹è¯•ååˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ° gitï¼‰
rm {starter-module}/src/test/resources/testng_ut_checkin_temp.xml
```

### ç¼–å†™è§„èŒƒï¼ˆTestNG + Mockitoï¼‰

- **@BeforeMethod é‡å»º SUT**ï¼šæ¯ä¸ªç”¨ä¾‹å…¨æ–°æ„é€ è¢«æµ‹ç±»åŠå…¶ mock ä¾èµ–ï¼Œé¿å…ç”¨ä¾‹é—´çŠ¶æ€æ±¡æŸ“
- **é™æ€æ–¹æ³• mock**ï¼šä½¿ç”¨ `try (MockedStatic<Xxx> m = mockStatic(Xxx.class)) { ... }` é™å®šä½œç”¨åŸŸ
- **é™æ€é…ç½®å½’ä½**ï¼šåœ¨ @BeforeMethod/@AfterMethod é‡ç½®é™æ€å­—æ®µï¼Œé¿å…ç”¨ä¾‹é—´å½±å“

---

## ä½¿ç”¨ç¤ºä¾‹

```bash
# ç¤ºä¾‹ 1ï¼šä½¿ç”¨å·²æœ‰çš„ dev-plan.md
/dev-code @.claude/specs/user-management/dev-plan.md

# ç¤ºä¾‹ 2ï¼šæä¾›éœ€æ±‚æè¿°
/dev-code å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼ŒåŒ…å«ï¼š1. ç”¨æˆ·åå¯†ç éªŒè¯ 2. JWT token ç”Ÿæˆ 3. ç™»å½•æ—¥å¿—è®°å½•

# ç¤ºä¾‹ 3ï¼šæ— å‚æ•°è°ƒç”¨ï¼ˆä¼šæç¤ºè¾“å…¥æ–¹æ¡ˆï¼‰
/dev-code
```
